## ERD

> **Entity Relationship Diagram**
> 

<br/>

- 데이터베이스를 구축할 때 가장 기초적인 뼈대 역할을 함
- 릴레이션 간의 관계를 정의한 다이어그램

</br>

### ERD 의 중요성

- ERD 는 시스템의 요구 사항을 기반으로 작성됨
- ERD 를 기반으로 데이터베이스를 구축한다.
- 데이터베이스를 구축한 이후에도 디버깅 또는 비즈니스 프로세스 재설계가 필요한 경우에 설계도 역할을 담당한다.

- ERD 는 관계형 구조로 표현할 수 있는 데이터를 구성하는 데 유용
- 비정형 데이터를 충분히 표현할 수는 없다는 단점이 있음

<br/>

비정형 데이터

- 비구조화 데이터를 말함. 구조가 없다.
- 미리 정의된 데이터 모델이 없거나, 미리 정의된 방식으로 정리되지 않은 정보를 말함

<br/>

---

## 정규화 과정

- 릴레이션 간 잘못된 종속 관계로 인해, 데이터베이스에 이상 현상이 일어나 이를 해결하거나, 저장 공간을 효율적으로 사용하기 위해 릴레이션을 여러 개로 분리하는 과정을 뜻함
    - 데이터 이상 현상 : 회원이 한 개의 등급을 가져야 하는데 두 개 이상의 등급을 갖거나 삭제할 때 필요한 데이터가 같이 삭제되거나, 데이터를 삽입해야 하는데 하나의 필드 값이 NULL 이 되어 삽입할 수 없는 현상 등이 있음
- 제1 정규형, 제2 정규형, 제3 정규형, 보이스/코드 정규형이 있음
- 고급 정규형인 제4 정규형, 제5 정규형이 있음

<br/>

### 정규형 원칙

- 같은 의미를 가지는 릴레이션이지만 자료의 중복을 제거하고, 더 좋은 구조로 만들어야 함
- 독립적인 관계는 별개의 릴레이션으로 표현해야 하고, 각각의 릴레이션은 독립적인 표현이 가능해야 함

<br/>

### 제1 정규형

- 릴레이션의 모든 데이터를 더 이상 분해할 수 없는 원자 값 (Atomic columns) 만으로 구성해야 함
- 하나의 속성에 여러 데이터가 들어가면 안된다.
- 데이터의 속성 값 중에서 한 개의 기본키에 대해 두 개 이상의 값을 가지는 반복 집합이 있어선 안된다.

![Untitled](./image/%EC%A0%9C1%EC%A0%95%EA%B7%9C%ED%98%95.png)

- 수강명, 성취도은 반복 집합. atomic value 로 분리
- 유저번호와 유저ID가 중복되는 데이터가 존재. 분리해야 함
- 유저 테이블과 수강 테이블로 분리되어야 함

<br/>

### 제2정규형

- 릴레이션이 제1정규형이면서, 기본키에 속하지 않은 속성 모두가 기본키에 완전 함수 종속이어야 한다. (그냥 기본키에 종속되어야 한다.)
    - 부분함수 종속이 아닌, 완전 종속!
- 완전 함수 종속을 만족하는 하나의 key 가 없다면 복합키에 대해서도 의존성 확인 가능함

![Untitled](./image/%EC%A0%9C2%EC%A0%95%EA%B7%9C%ED%98%95.png)

- 유저 ID 는 유저 번호에 의존하므로 유저 번호, 유저 ID 를 가지는 테이블로 분리할 수 있음
- 성취도는 유저 ID, 수강명 의 복합키에 의존하므로 {유저 ID, 수강명} 에 따른 성취도 테이블로 분리할 수 있음
- 이 때, 정보 손실이 발생하지 않는 무손실 분해로 분해되어야 함

<br/>

### 제3정규형

- 릴레이션이 제2정규형이면서, 기본키가 아닌 모든 속성이 기본키에만 의존하고 다른 후보키에 의존하지 않아야 한다.
- “이행적 함수 종속”을 만족하지 않아야 한다.
    - A → B 와 B → C 가 존재하면 A → C 가 성립. 이 때 집합 C 가 A 에게 이행적으로 함수 종속이 되었다고 함

<br/>    

예를 들어, 학생 테이블에 ‘대학’ 과 ‘전공’ 속성이 있다고 하자.

‘대학’ 과 ‘전공’ 은 기본키가 아님에도 불구하고 종속관계가 성립한다.

‘대학’ 은 ‘전공’ 을 포함하기 때문

ex) 생물학과면 무조건 이과대학에 포함, 컴퓨터학과이면 IT 대학에 포함

따라서 학생 테이블에는 전공 정보만 포함하고, 대학, 전공을 가지는 테이블을 따로 빼야 한다. 

<br/>

### 보이스/코드 정규형 (BCNF)

- 제 3정규형이면서, 함수 종속 관계에서 모든 결정자가 후보키이어야 한다.

결정자 ?

- 함수 종속 관계에서 특정 종속자 (dependent) 를 결정짓는 요소.
- X → Y 일 때 X 는 결정자, Y 는 종속
- ex) 주민등록번호 (결정자) → 이름 (종속자) / 성별 (종속자)

- 특정 속성에 대한 결정자인데, 테이블에서 후보키가 아니면 해당 속성을 분리해야 함

![Untitled](./image/%EB%B3%B4%EC%9D%B4%EC%8A%A4%EC%BD%94%EB%93%9C%EC%A0%95%EA%B7%9C%ED%98%95.png)

조건

- 각 수강명에 대해 한 학생은 오직 한 강사의 강의만 수강한다.
- 각 강사는 한 수강명만 담당한다.
- 한 수강명은 여러 강사가 담당할 수 있다.

<br/>

강사는 수강명에 대한 결정자. 학번은 강사에 대한 결정자

따로 테이블을 빼내면 다음과 같아진다. 


<br/>

---

정규화 과정을 거쳐 테이블을 나눈다고 해서, 성능이 100% 좋아지는 것은 아님

테이블을 너무 세세하게 나누면, join 연산이 많아지므로 오히려 느려질 수 있다.

서비스에 따라 정규화/비정규화를 적절히 진행해야 한다!